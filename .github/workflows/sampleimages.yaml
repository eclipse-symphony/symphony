name: SampleImages

on:
  workflow_dispatch:
permissions: write-all
env:
  ContainerRegistry: "ghcr.io"
  ContainerRegistryRepo: "ghcr.io/eclipse-symphony"

jobs:
  build:
    if: github.repository == 'eclipse-symphony/symphony' && (github.actor == 'chgennar' || github.actor == 'juancooldude' || github.actor == 'Haishi2016' || github.actor == 'nonsocode' || github.actor == 'msftcoderdjw' || github.actor == 'TonyXiaofeng' || github.actor == 'RemindD') 
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          registry: ${{ env.ContainerRegistry }}
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.21  # Replace with your desired Go version

      - name: Install Helm
        run: |
          curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
          chmod 700 get_helm.sh
          ./get_helm.sh

      - name: Pull symphonycr.azurecr.io/simple-chart:0.3.0
        run: |
          helm pull oci://symphonycr.azurecr.io/simple-chart --version 0.3.0

      - name: Push ${{ env.ContainerRegistryRepo }}/tests/helm/simple-chart:0.3.0
        run: |
          helm push simple-chart-0.3.0.tgz oci://${{ env.ContainerRegistryRepo }}/tests/helm