apiVersion: workflow.symphony/v1
kind: Campaign
metadata:
  name: approval-campaign
spec:
  firstStage: "approval"
  selfDriving: true
  stages:
    approval:
      name: "approval"
      provider: "providers.stage.script"     
      config: 
        scriptFolder: "https://demopolicies.blob.core.windows.net/scripts"
        scriptEngine: "bash"
        script: "mock-reject.sh"
      stageSelector: ${{$if($equal($output(approval,status), 200),'deploy','end')}}     
    deploy:
      name: "deploy"
      provider: "providers.stage.materialize"
      config:
        baseUrl: http://symphony-service:8080/v1alpha2/
        user: admin
        password: ""
      inputs:
        names:
        - "gated-prometheus-instance"
    end:
      name: "end"
      provider: "providers.stage.mock"      
      stageSelector: ""  